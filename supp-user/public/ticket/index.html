<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="robots" content="noindex">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>supp user</title>
		<link rel="stylesheet" href="/css/style.css">
	</head>
	<body>
		<div id="app" style="display: none;">
			<h1>ticket</h1>
			<div id="contents"></div>
		</div>
		<script src="/js/login.js"></script>
		<script>
			{
				window.addEventListener("login", onLogin);
				async function onLogin(event) {
					window.removeEventListener("login", onLogin);
					if (!event.detail) {
						window.location.href = "/login/";
						return;
					}
					
					let params = new URLSearchParams(window.location.search);
					let ticketId = parseInt(params.get("id"), 10);
					fetch(
						"http://localhost:3000/ticket/content/?ticketId=" + String(ticketId),
						{
							credentials: "include",
							method: "GET",
							headers: {
								"Content-Type": "application/json",
							},
						}
					)
						.then(res => res.json())
						.then(json => {
							const contents = document.querySelector("#contents");
							
							if (json.result === "fail") {
								contents.innerHTML = "<p>failed to fetch contents</p>";
								return;
							}
							
							let string = "<ul>";
							json.contents.map(content => {
								string += "<li><p>" + content.username + "</p><p>" + content.content + "</p></li>";
							});
							string += "</ul>";
							contents.innerHTML = string;
						})
						.catch(error => {
							const contents = document.querySelector("#contents");
							contents.innerHTML = "<p>failed to fetch contents</p>";
						});
					
					window.dispatchEvent(new Event("show"));
				}
			}
		</script>
	</body>
</html>